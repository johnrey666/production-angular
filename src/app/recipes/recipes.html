<div class="recipes" @fadeInUp>
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1>Recipes</h1>
      <p>Product formulations and ingredient standards</p>
    </div>
    <button class="btn-primary" (click)="addRecipe()">
      <svg class="btn-icon" width="14" height="14" viewBox="0 0 14 14" fill="none">
        <path d="M7 3V11M3 7H11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      New Recipe
    </button>
  </div>

  <!-- Recipes List -->
  <div class="recipes-container">
    <div *ngFor="let recipe of recipes; let i = index" class="recipe-card" @slideIn>
      <!-- Recipe Header -->
      <div class="recipe-header">
        <input 
          [(ngModel)]="recipe.name" 
          (blur)="saveRecipes()"
          placeholder="Recipe Name"
          class="recipe-name-input"
        >
        <button class="btn-icon-danger" (click)="deleteRecipe(i)" aria-label="Delete recipe">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M3.5 3.5L10.5 10.5M3.5 10.5L10.5 3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <!-- Recipe Configuration -->
      <div class="recipe-config">
        <div class="config-item">
          <label>Batch Size</label>
          <div class="config-input-group">
            <input 
              type="number" 
              [(ngModel)]="recipe.batchSize" 
              (blur)="saveRecipes()"
              min="1"
              class="config-input"
              placeholder="0"
            >
            <span class="config-unit">units</span>
          </div>
        </div>
        <div class="config-item">
          <label>Yield</label>
          <div class="config-input-group">
            <input 
              type="number" 
              [(ngModel)]="recipe.yieldKg" 
              (blur)="saveRecipes()"
              step="0.1"
              min="0"
              class="config-input"
              placeholder="0.0"
            >
            <span class="config-unit">kg</span>
          </div>
        </div>
        <div class="config-item">
          <label>Batch Cost</label>
          <div class="cost-display">₱{{ calculateRecipeCost(recipe) | number:'1.0-0' }}</div>
        </div>
        <div class="config-item">
          <label>Cost/kg</label>
          <div class="cost-display">₱{{ calculateCostPerKg(recipe) | number:'1.1-1' }}</div>
        </div>
      </div>

      <!-- Ingredients Section -->
      <div class="ingredients-section">
        <div class="section-header">
          <h3>Ingredients</h3>
          <button class="btn-secondary" (click)="addIngredient(i)">
            <svg class="btn-icon" width="12" height="12" viewBox="0 0 12 12" fill="none">
              <path d="M6 2V10M2 6H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Add Ingredient
          </button>
        </div>

        <div class="table-container">
          <table class="ingredients-table">
            <thead>
              <tr>
                <th>Material</th>
                <th>SKU</th>
                <th class="text-right">Qty/Batch</th>
                <th class="text-right">Unit Cost</th>
                <th class="text-right">Cost</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ingredient of recipe.ingredients; let j = index">
                <td>
                  <select 
                    [(ngModel)]="ingredient.sku" 
                    (change)="onIngredientChange(i, j)"
                    class="table-select"
                  >
                    <option value="">Select Material</option>
                    <option 
                      *ngFor="let material of rawMaterials" 
                      [value]="material.sku"
                    >
                      {{ material.description }}
                    </option>
                  </select>
                </td>
                <td class="sku">{{ ingredient.sku || '–' }}</td>
                <td class="text-right">
                  <div class="qty-input-group">
                    <input 
                      type="number" 
                      [(ngModel)]="ingredient.qty" 
                      (blur)="saveRecipes()"
                      step="0.001"
                      min="0"
                      class="table-input number"
                      placeholder="0.000"
                    >
                    <span class="unit">kg</span>
                  </div>
                </td>
                <td class="text-right">
                  <span class="cost-value">₱{{ getMaterialCost(ingredient.sku) | number:'1.2-2' }}</span>
                </td>
                <td class="text-right">
                  <span class="cost-value">₱{{ calculateIngredientCost(ingredient) | number:'1.2-2' }}</span>
                </td>
                <td class="actions">
                  <button class="btn-icon-danger" (click)="deleteIngredient(i, j)" aria-label="Delete">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                      <path d="M3 3L9 9M3 9L9 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Empty State -->
        <div *ngIf="recipe.ingredients.length === 0" class="empty-state">
          <div class="empty-icon">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
              <path d="M16 10V22M10 16H22" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round"/>
              <rect x="6" y="6" width="20" height="20" rx="2" stroke="#9CA3AF" stroke-width="1.5"/>
            </svg>
          </div>
          <p>No ingredients added</p>
          <button class="btn-secondary" (click)="addIngredient(i)">
            Add First Ingredient
          </button>
        </div>
      </div>

      <!-- Recipe Summary -->
      <div class="recipe-footer">
        <div class="summary-grid">
          <div class="summary-item">
            <div class="summary-label">Ingredients</div>
            <div class="summary-value">{{ recipe.ingredients.length }}</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Batch Cost</div>
            <div class="summary-value">₱{{ calculateRecipeCost(recipe) | number:'1.0-0' }}</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Cost/kg</div>
            <div class="summary-value">₱{{ calculateCostPerKg(recipe) | number:'1.1-1' }}</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Yield %</div>
            <div class="summary-value">{{ calculateEfficiency(recipe) }}%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State for No Recipes -->
  <div *ngIf="recipes.length === 0" class="empty-recipes" @fadeInUp>
    <div class="empty-content">
      <div class="empty-icon">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <path d="M16 20H32M16 28H24" stroke="#6B7280" stroke-width="2" stroke-linecap="round"/>
          <rect x="10" y="10" width="28" height="28" rx="2" stroke="#6B7280" stroke-width="2"/>
        </svg>
      </div>
      <h3>No recipes yet</h3>
      <p>Create your first recipe to start production planning</p>
      <button class="btn-primary" (click)="addRecipe()">
        <svg class="btn-icon" width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M7 3V11M3 7H11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        Create Recipe
      </button>
    </div>
  </div>
</div>