<!-- Loading State - CLEAN & CENTERED -->
<div *ngIf="isLoading" class="dashboard-loading">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p class="loading-text">{{ loadingMessage }}</p>
  </div>
</div>

<!-- Main Content -->
<div class="dashboard" [class.content-loading]="isLoading" @fadeInUp>
  <div class="dashboard-content">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-left">
        <h1 class="dashboard-title">Daily Production Record</h1>
        <div class="date-info">
          <span class="current-date">{{ formatDate(selectedDate) }}</span>
          <span class="separator">â€¢</span>
          <span class="period">{{ getMonthName(currentMonth) }} {{ currentYear }}</span>
        </div>
      </div>
      
      <!-- Calendar Widget in Header -->
      <div class="header-right">
        <div class="calendar-widget">
          <div class="calendar-input" (click)="toggleCalendar()">
            <span>{{ formatDate(selectedDate) }}</span>
            <svg class="calendar-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
          
          <!-- Calendar Dropdown -->
          <div class="calendar-dropdown" *ngIf="showCalendar">
            <div class="calendar-header">
              <button class="calendar-nav-btn" (click)="prevMonth(); $event.stopPropagation()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
              </button>
              <div class="calendar-month-year">
                <span class="calendar-month">{{ getMonthName(currentMonth) }}</span>
                <span class="calendar-year">{{ currentYear }}</span>
              </div>
              <button class="calendar-nav-btn" (click)="nextMonth(); $event.stopPropagation()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </button>
            </div>
            
            <!-- Monthly View Button -->
            <div class="monthly-view-btn" (click)="showMonthlyView(); $event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
                <path d="M8 14h.01"></path>
                <path d="M12 14h.01"></path>
                <path d="M16 14h.01"></path>
                <path d="M8 18h.01"></path>
                <path d="M12 18h.01"></path>
                <path d="M16 18h.01"></path>
              </svg>
              View Monthly Summary
            </div>
            
            <!-- Monthly Total Display -->
            <div class="monthly-total" *ngIf="monthlyTotal > 0">
              <div class="monthly-total-label">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                Monthly Total
              </div>
              <div class="monthly-total-amount">
                {{ monthlyTotal | number:'1.1-2' }} batches
              </div>
            </div>
            
            <div class="calendar-weekdays">
              <div class="weekday">S</div>
              <div class="weekday">M</div>
              <div class="weekday">T</div>
              <div class="weekday">W</div>
              <div class="weekday">T</div>
              <div class="weekday">F</div>
              <div class="weekday">S</div>
            </div>
            
            <div class="calendar-days">
              <div *ngFor="let day of calendarDays" 
                  class="day"
                  [class.empty]="day === 0"
                  [class.today]="isToday(day)"
                  [class.selected]="isSelected(day)"
                  [class.has-production]="hasProduction(day)"
                  (click)="selectDate(day); $event.stopPropagation()">
                {{ day === 0 ? '' : day }}
                <div *ngIf="hasProduction(day)" class="day-production-indicator">
                  {{ getDayProduction(day) | number:'1.0-1' }}
                </div>
              </div>
            </div>
            
            <div class="calendar-quick-actions">
              <button class="quick-action-btn" (click)="selectToday(); $event.stopPropagation()">Today</button>
              <button class="quick-action-btn" (click)="selectYesterday(); $event.stopPropagation()">Yesterday</button>
              <button class="quick-action-btn" (click)="selectLastWeek(); $event.stopPropagation()">Last Week</button>
            </div>
          </div>
        </div>
        
        <button class="refresh-btn" (click)="refreshData()" [disabled]="isLoading">
          <svg class="refresh-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6"></path>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
          </svg>
          <span>{{ isLoading ? 'Refreshing...' : 'Refresh' }}</span>
        </button>
        
        <button class="export-btn" (click)="exportToExcel()" [disabled]="filteredEntries.length === 0">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export Excel
        </button>
      </div>
    </header>

    <!-- View Mode Toggle (Monthly View Only) -->
    <div *ngIf="viewMode === 'monthly'" class="view-mode-section">
      <div class="section-header">
        <h2>Monthly Production Summary: {{ getMonthName(currentMonth) }} {{ currentYear }}</h2>
        <div class="section-header-right">
          <div class="monthly-stats">
            <span class="stat-badge">{{ filteredMonthlyEntries.length }} recipes</span>
            <span class="stat-badge">{{ monthlyTotal | number:'1.1-2' }} total batches</span>
          </div>
          <button class="btn-secondary" (click)="switchToDailyView()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to Daily
          </button>
          <button class="export-btn" (click)="exportMonthlySummary()" [disabled]="filteredMonthlyEntries.length === 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Export Monthly
          </button>
        </div>
      </div>
    </div>

    <!-- Summary Stats (Daily View) -->
    <div *ngIf="viewMode === 'daily'" class="stats-container">
      <div class="stat-item">
        <div class="stat-value">{{ getTotalOrder() | number:'1.1-2' }}</div>
        <div class="stat-label">Total Order</div>
        <div class="stat-trend">batches</div>
      </div>
      
      <div class="stat-item">
        <div class="stat-value">{{ getTotalActualRawMat() | number:'1.1-2' }}</div>
        <div class="stat-label">Total Raw Mat</div>
        <div class="stat-trend">batches</div>
      </div>
      
      <div class="stat-item">
        <div class="stat-value">{{ filteredEntries.length }}</div>
        <div class="stat-label">Recipes</div>
        <div class="stat-trend">Active</div>
      </div>
      
      <div class="stat-item">
        <div class="stat-value">â‚±{{ getTotalRawMatCost() | number:'1.0-0' }}</div>
        <div class="stat-label">Total Cost</div>
        <div class="stat-trend">Amount</div>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-box">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input 
          type="text" 
          placeholder="Search recipes or SKUs..." 
          *ngIf="viewMode === 'daily'"
          [(ngModel)]="searchQuery" 
          (input)="onSearch()"
        >
        <input 
          type="text" 
          placeholder="Search monthly recipes or SKUs..." 
          *ngIf="viewMode === 'monthly'"
          [(ngModel)]="monthlySearchQuery" 
          (input)="onMonthlySearch()"
        >
      </div>
      
      <div class="table-info">
        <span>
          {{ (viewMode === 'daily' ? filteredEntries.length : filteredMonthlyEntries.length) }} 
          recipe{{ (viewMode === 'daily' ? filteredEntries.length : filteredMonthlyEntries.length) !== 1 ? 's' : '' }}
          <span *ngIf="viewMode === 'daily' && isDataLoadedFromStorage" class="unsaved-badge">* Unsaved changes</span>
        </span>
        <span *ngIf="viewMode === 'daily'">
          Date: {{ formatDate(selectedDate) }}
        </span>
        <span *ngIf="viewMode === 'monthly'">
          Month: {{ getMonthName(currentMonth) }} {{ currentYear }}
        </span>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="error-state">
      <div class="error-content">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        <p>{{ errorMessage }}</p>
        <button class="btn-secondary" (click)="loadData()">Retry</button>
      </div>
    </div>

    <!-- Content Area -->
    <div *ngIf="!isLoading && !errorMessage" class="main-content">
      
      <!-- DAILY VIEW: Production Cards -->
      <div *ngIf="viewMode === 'daily'" class="production-entries">
        <div *ngFor="let entry of paginated" class="production-card">
          
          <!-- Recipe Header (collapsible) -->
          <div class="recipe-header" (click)="toggleRecipe(entry)">
            <div class="recipe-header-left">
              <button class="collapse-btn" [class.collapsed]="!entry.isExpanded">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div class="recipe-info">
                <h3 class="recipe-name">{{ entry.recipe.name }}</h3>
                <div class="recipe-stats">
                  <span class="stat-badge">{{ getTotalSkus(entry) }} SKU{{ getTotalSkus(entry) !== 1 ? 's' : '' }}</span>
                  <span class="stat-badge">{{ entry.recipe.std_yield || 0 }} STD</span>
                </div>
              </div>
            </div>
            <div class="order-section" (click)="$event.stopPropagation()">
              <div class="order-input-group">
                <label for="order-{{entry.recipe.id}}">Order (batch):</label>
                <input 
                  type="number" 
                  id="order-{{entry.recipe.id}}"
                  [(ngModel)]="entry.orderKg" 
                  (input)="recalculate(entry)"
                  (click)="$event.stopPropagation()"
                  step="0.1" 
                  min="0" 
                  class="order-input"
                  placeholder="0.0">
              </div>
            </div>
          </div>

          <!-- Collapsible Content -->
          <div class="collapsible-content" [class.expanded]="entry.isExpanded">
            <!-- Combined SKUs & Premixes Table -->
            <div class="table-wrapper" *ngIf="getAllItems(entry).length > 0">
              <div class="table-container">
                <table class="compact-table">
                  <thead>
                    <tr>
                      <th style="width: 200px;">SKU / Description</th>
                      <th style="width: 70px;" class="text-right">1B</th>
                      <th style="width: 70px;" class="text-right">Â½B</th>
                      <th style="width: 70px;" class="text-right">Â¼B</th>
                      <th style="width: 100px;" class="text-right">ACTUAL RAW MAT</th>
                      <th style="width: 100px;">ACTUAL OUTPUT</th>
                      <th style="width: 90px;">VARIANCE</th>
                      <th style="width: 110px;">RAW MAT COST</th>
                      <th style="width: 150px;">REMARK</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- SKUs -->
                    <tr *ngFor="let sku of entry.recipe.skus" class="table-row">
                      <td>
                        <div class="item-info">
                          <div class="item-name">{{ sku.name }}</div>
                          <div class="item-type type-sku">SKU</div>
                        </div>
                      </td>
                      <td class="text-right number">{{ sku.quantity1b | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ sku.quantityhalfb | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ sku.quantityquarterb | number:'1.3-3' }}</td>
                      <td class="text-right actual-raw-mat">
                        {{ calculateActualRawMat(entry.orderKg, sku.quantity1b) | number:'1.3-3' }}
                      </td>
                      <td>
                        <input type="number" 
                              [(ngModel)]="sku.actualOutput"
                              (input)="onItemChange(entry)"
                              step="0.001" 
                              min="0" 
                              class="table-input text-center"
                              style="width: 90px;">
                      </td>
                      <td>
                        <input type="number" 
                              [(ngModel)]="sku.variance"
                              (input)="onItemChange(entry)"
                              step="0.001" 
                              class="table-input text-center"
                              style="width: 80px;">
                      </td>
                      <td>
                        <input type="number" 
                              [(ngModel)]="sku.rawMatCost"
                              (input)="onItemChange(entry)"
                              step="0.01" 
                              min="0" 
                              class="table-input text-center"
                              style="width: 100px;"
                              placeholder="â‚±">
                      </td>
                      <td>
                        <input type="text" 
                              [(ngModel)]="sku.remark"
                              (input)="onItemChange(entry)"
                              class="table-input"
                              style="width: 140px;"
                              placeholder="Notes...">
                      </td>
                    </tr>
                    
                    <!-- Premixes -->
                    <tr *ngFor="let premix of entry.recipe.premixes" class="table-row">
                      <td>
                        <div class="item-info">
                          <div class="item-name">{{ premix.name }}</div>
                          <div class="item-type type-premix">PRE-MIX</div>
                        </div>
                      </td>
                      <td class="text-right number">{{ premix.quantity1b | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ premix.quantityhalfb | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ premix.quantityquarterb | number:'1.3-3' }}</td>
                      <td class="text-right actual-raw-mat">
                        {{ calculateActualRawMat(entry.orderKg, premix.quantity1b) | number:'1.3-3' }}
                      </td>
                      <td>
                        <input type="number" 
                              [(ngModel)]="premix.actualOutput"
                              (input)="onItemChange(entry)"
                              step="0.001" 
                              min="0" 
                              class="table-input text-center"
                              style="width: 90px;">
                      </td>
                      <td>
                        <input type="number" 
                              [(ngModel)]="premix.variance"
                              (input)="onItemChange(entry)"
                              step="0.001" 
                              class="table-input text-center"
                              style="width: 80px;">
                      </td>
                      <td>
                        <input type="number" 
                              [(ngModel)]="premix.rawMatCost"
                              (input)="onItemChange(entry)"
                              step="0.01" 
                              min="0" 
                              class="table-input text-center"
                              style="width: 100px;"
                              placeholder="â‚±">
                      </td>
                      <td>
                        <input type="text" 
                              [(ngModel)]="premix.remark"
                              (input)="onItemChange(entry)"
                              class="table-input"
                              style="width: 140px;"
                              placeholder="Notes...">
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- No Items Message -->
            <div *ngIf="getAllItems(entry).length === 0" class="empty-items">
              <p>No SKUs defined for this recipe.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- MONTHLY VIEW: Production Cards -->
      <div *ngIf="viewMode === 'monthly'" class="production-entries">
        <div *ngFor="let entry of monthlyPaginated" class="production-card">
          
          <!-- Recipe Header (collapsible) -->
          <div class="recipe-header" (click)="toggleRecipe(entry)">
            <div class="recipe-header-left">
              <button class="collapse-btn" [class.collapsed]="!entry.isExpanded">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div class="recipe-info">
                <h3 class="recipe-name">{{ entry.recipe.name }}</h3>
                <div class="recipe-stats">
                  <span class="stat-badge">{{ getTotalSkus(entry) }} SKU{{ getTotalSkus(entry) !== 1 ? 's' : '' }}</span>
                  <span class="stat-badge">{{ entry.recipe.std_yield || 0 }} STD</span>
                  <span class="stat-badge">{{ entry.daysWithOrders || 0 }} day{{ entry.daysWithOrders !== 1 ? 's' : '' }}</span>
                </div>
              </div>
            </div>
            <div class="order-section">
              <div class="order-input-group">
                <label>Total Order (batch):</label>
                <div class="order-total">
                  {{ entry.orderKg | number:'1.1-2' }}
                </div>
              </div>
            </div>
          </div>
                    
          
          <!-- Collapsible Content -->
          <div class="collapsible-content" [class.expanded]="entry.isExpanded">
            <!-- Combined SKUs & Premixes Table -->
            <div class="table-wrapper" *ngIf="getAllItems(entry).length > 0">
              <div class="table-container">
                <table class="compact-table">
                  <thead>
                    <tr>
                      <th style="width: 200px;">SKU / Raw Material</th>
                      <th style="width: 70px;" class="text-right">1B</th>
                      <th style="width: 70px;" class="text-right">Â½B</th>
                      <th style="width: 70px;" class="text-right">Â¼B</th>
                      <th style="width: 100px;" class="text-right">ACTUAL RAW MAT</th>
                      <th style="width: 100px;">ACTUAL OUTPUT</th>
                      <th style="width: 90px;">VARIANCE</th>
                      <th style="width: 110px;">RAW MAT COST</th>
                      <th style="width: 150px;">REMARK</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- SKUs -->
                    <tr *ngFor="let sku of entry.recipe.skus" class="table-row">
                      <td>
                        <div class="item-info">
                          <div class="item-name">{{ sku.name }}</div>
                          <div class="item-type type-sku">SKU</div>
                        </div>
                      </td>
                      <td class="text-right number">{{ sku.quantity1b | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ sku.quantityhalfb | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ sku.quantityquarterb | number:'1.3-3' }}</td>
                      <td class="text-right actual-raw-mat">
                        {{ calculateActualRawMat(entry.orderKg, sku.quantity1b) | number:'1.3-3' }}
                      </td>
                      <td>
                        <div class="monthly-value">{{ sku.actualOutput | number:'1.3-3' }}</div>
                      </td>
                      <td>
                        <div class="monthly-value">N/A</div>
                      </td>
                      <td>
                        <div class="monthly-value">â‚± {{ sku.rawMatCost | number:'1.2-2' }}</div>
                      </td>
                      <td>
                        <div class="monthly-remark">{{ sku.remark }}</div>
                      </td>
                    </tr>
                    
                    <!-- Premixes -->
                    <tr *ngFor="let premix of entry.recipe.premixes" class="table-row">
                      <td>
                        <div class="item-info">
                          <div class="item-name">{{ premix.name }}</div>
                          <div class="item-type type-premix">PRE-MIX</div>
                        </div>
                      </td>
                      <td class="text-right number">{{ premix.quantity1b | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ premix.quantityhalfb | number:'1.3-3' }}</td>
                      <td class="text-right number">{{ premix.quantityquarterb | number:'1.3-3' }}</td>
                      <td class="text-right actual-raw-mat">
                        {{ calculateActualRawMat(entry.orderKg, premix.quantity1b) | number:'1.3-3' }}
                      </td>
                      <td>
                        <div class="monthly-value">{{ premix.actualOutput | number:'1.3-3' }}</div>
                      </td>
                      <td>
                        <div class="monthly-value">N/A</div>
                      </td>
                      <td>
                        <div class="monthly-value">â‚± {{ premix.rawMatCost | number:'1.2-2' }}</div>
                      </td>
                      <td>
                        <div class="monthly-remark">{{ premix.remark }}</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- No Items Message -->
            <div *ngIf="getAllItems(entry).length === 0" class="empty-items">
              <p>No SKUs defined for this recipe.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div *ngIf="viewMode === 'daily' && filteredEntries.length > 0" class="pagination">
        <div class="pagination-info">
          Showing {{ ((currentPage - 1) * itemsPerPage) + 1 }}â€“{{ (currentPage * itemsPerPage > filteredEntries.length ? filteredEntries.length : currentPage * itemsPerPage) }} of {{ filteredEntries.length }} recipe{{ filteredEntries.length !== 1 ? 's' : '' }}
        </div>
        <div class="pagination-controls">
          <button class="pagination-btn" (click)="prevPage()" [disabled]="currentPage === 1">
            Previous
          </button>
          <div class="page-numbers">
            <span class="current-page">{{ currentPage }}</span> of <span class="total-pages">{{ totalPages }}</span>
          </div>
          <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
            Next
          </button>
        </div>
      </div>

      <!-- Monthly Pagination -->
      <div *ngIf="viewMode === 'monthly' && filteredMonthlyEntries.length > 0" class="pagination">
        <div class="pagination-info">
          Showing {{ ((monthlyCurrentPage - 1) * itemsPerPage) + 1 }}â€“{{ (monthlyCurrentPage * itemsPerPage > filteredMonthlyEntries.length ? filteredMonthlyEntries.length : monthlyCurrentPage * itemsPerPage) }} of {{ filteredMonthlyEntries.length }} recipe{{ filteredMonthlyEntries.length !== 1 ? 's' : '' }}
        </div>
        <div class="pagination-controls">
          <button class="pagination-btn" (click)="prevMonthlyPage()" [disabled]="monthlyCurrentPage === 1">
            Previous
          </button>
          <div class="page-numbers">
            <span class="current-page">{{ monthlyCurrentPage }}</span> of <span class="total-pages">{{ monthlyTotalPages }}</span>
          </div>
          <button class="pagination-btn" (click)="nextMonthlyPage()" [disabled]="monthlyCurrentPage === monthlyTotalPages">
            Next
          </button>
        </div>
      </div>

      <!-- Summary -->
      <div *ngIf="viewMode === 'daily' && filteredEntries.length > 0" class="summary-bar">
        <div class="summary-item">
          <span class="summary-label">Production Date:</span>
          <span class="summary-value">{{ selectedDate }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Order:</span>
          <span class="summary-value">{{ getTotalOrder() | number:'1.1-2' }} batch</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Raw Mat:</span>
          <span class="summary-value">{{ getTotalActualRawMat() | number:'1.1-2' }} batch</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Cost:</span>
          <span class="summary-value">â‚± {{ getTotalRawMatCost() | number:'1.0-0' }}</span>
        </div>
        <div class="summary-item" *ngIf="isDataLoadedFromStorage">
          <span class="summary-label unsaved-label">* Auto-saving changes...</span>
        </div>
      </div>

      <!-- Monthly Summary -->
      <div *ngIf="viewMode === 'monthly' && filteredMonthlyEntries.length > 0" class="summary-bar">
        <div class="summary-item">
          <span class="summary-label">Month:</span>
          <span class="summary-value">{{ getMonthName(currentMonth) }} {{ currentYear }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Order:</span>
          <span class="summary-value">{{ getTotalOrder() | number:'1.1-2' }} batch</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Raw Mat:</span>
          <span class="summary-value">{{ getTotalActualRawMat() | number:'1.1-2' }} batch</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Cost:</span>
          <span class="summary-value">â‚± {{ getTotalRawMatCost() | number:'1.0-0' }}</span>
        </div>
      </div>

      <!-- No Data for Selected Date (Daily view) -->
      <div *ngIf="viewMode === 'daily' && filteredEntries.length === 0 && !isLoading" class="empty-state">
        <div style="font-size: 64px; margin-bottom: 1rem;">ðŸ“…</div>
        <h3 style="font-size: 18px; margin: 0.5rem 0;">No production data for {{ selectedDate }}</h3>
        <p style="color:#666; font-size: 16px;">Enter order quantities to start recording production</p>
      </div>

      <!-- No Data for Month (Monthly view) -->
      <div *ngIf="viewMode === 'monthly' && filteredMonthlyEntries.length === 0 && !isLoading" class="empty-state">
        <div style="font-size: 64px; margin-bottom: 1rem;">ðŸ“Š</div>
        <h3 style="font-size: 18px; margin: 0.5rem 0;">No production data for {{ getMonthName(currentMonth) }} {{ currentYear }}</h3>
        <p style="color:#666; font-size: 16px;">Enter daily production data to see monthly totals</p>
      </div>
    </div>
  </div>
</div>

<!-- Snackbar -->
<div class="snackbar-container" *ngIf="snackbarMessage">
  <div class="snackbar" [class]="'snackbar-' + snackbarType">
    <div class="snackbar-content">
      <div class="snackbar-icon">
        <svg *ngIf="snackbarType === 'success'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        <svg *ngIf="snackbarType === 'error'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <div class="snackbar-message">{{ snackbarMessage }}</div>
    </div>
    <button class="snackbar-close" (click)="hideSnackbar()">Ã—</button>
  </div>
</div>