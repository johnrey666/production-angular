<div class="reports" @fadeInUp>
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Reports & Analytics</h1>
      <p>Comprehensive production reports and performance analytics</p>
    </div>
  </div>

  <!-- Report Controls -->
  <div class="controls-card">
    <div class="controls-header">
      <div class="controls-title">Select Report Period</div>
      <div class="controls-group">
        <input 
          type="month" 
          [(ngModel)]="selectedMonth" 
          (change)="generateReport()"
          class="month-input"
        >
        <button class="btn-primary" (click)="exportCSV()">
          <i class="icon">üìä</i>
          Export CSV
        </button>
        <button class="btn-secondary" (click)="printReport()">
          <i class="icon">üñ®Ô∏è</i>
          Print
        </button>
      </div>
    </div>
  </div>

  <!-- Summary Stats -->
  <div class="stats-grid">
    <div class="stat-card" @slideIn>
      <div class="stat-content">
        <div class="stat-value">{{ summaryData.totalDays }}</div>
        <div class="stat-label">Production Days</div>
      </div>
      <div class="stat-icon">üìÖ</div>
    </div>
    <div class="stat-card" @slideIn>
      <div class="stat-content">
        <div class="stat-value">{{ summaryData.totalOutput | number:'1.0-0' }} kg</div>
        <div class="stat-label">Total Output</div>
      </div>
      <div class="stat-icon">‚öñÔ∏è</div>
    </div>
    <div class="stat-card" @slideIn>
      <div class="stat-content">
        <div class="stat-value">{{ summaryData.totalCost | currency:'‚Ç±':'symbol':'1.0-0' }}</div>
        <div class="stat-label">Total Raw Cost</div>
      </div>
      <div class="stat-icon">üí∞</div>
    </div>
    <div class="stat-card" @slideIn>
      <div class="stat-content">
        <div class="stat-value">{{ summaryData.avgCostPerKg | currency:'‚Ç±':'symbol':'1.0-0' }}</div>
        <div class="stat-label">Avg ‚Ç±/kg</div>
      </div>
      <div class="stat-icon">üìà</div>
    </div>
  </div>

  <!-- Production Report Table -->
  <div class="table-card">
    <div class="card-header">
      <div class="card-title">Production Report - {{ selectedMonth | date:'MMMM yyyy' }}</div>
      <div class="report-actions">
        <button class="btn-secondary" (click)="toggleVarianceView()">
          <i class="icon">{{ showVarianceOnly ? 'üìã' : 'üìä' }}</i>
          {{ showVarianceOnly ? 'Show All' : 'Variance Only' }}
        </button>
      </div>
    </div>

    <div class="table-container">
      <table class="report-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Product</th>
            <th>Order (batches)</th>
            <th>Expected kg</th>
            <th>Actual kg</th>
            <th>Raw Used kg</th>
            <th>Raw Cost</th>
            <th>Variance kg</th>
            <th>Efficiency</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of filteredRecords" @slideIn 
              [class.high-variance]="record.variance > 10 || record.variance < -10"
              [class.low-variance]="(record.variance <= 10 && record.variance >= -10) && record.variance !== 0">
            <td class="date">{{ record.date }}</td>
            <td class="product">{{ record.product }}</td>
            <td class="number">{{ record.batches | number:'1.1-1' }}</td>
            <td class="number">{{ record.expected | number:'1.1-1' }}</td>
            <td class="number">{{ record.actual | number:'1.1-1' }}</td>
            <td class="number">{{ record.rawUsed | number:'1.1-1' }}</td>
            <td class="cost">{{ record.rawCost | currency:'‚Ç±':'symbol':'1.0-0' }}</td>
            <td class="variance" [class]="record.variance >= 0 ? 'positive' : 'negative'">
              {{ record.variance >= 0 ? '+' : '' }}{{ record.variance | number:'1.1-1' }}
            </td>
            <td class="efficiency">
              <div class="efficiency-bar">
                <div class="efficiency-fill" [style.width.%]="calculateEfficiency(record)"></div>
                <span class="efficiency-text">{{ calculateEfficiency(record) }}%</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredRecords.length === 0" class="empty-state">
      <div class="empty-icon">üìä</div>
      <h3>No Data Available</h3>
      <p>No production data found for the selected period</p>
      <button class="btn-secondary" (click)="loadSampleData()">
        Load Sample Data
      </button>
    </div>

    <!-- Report Summary -->
    <div class="report-summary" *ngIf="filteredRecords.length > 0">
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Total Records</div>
          <div class="summary-value">{{ filteredRecords.length }}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Positive Variance</div>
          <div class="summary-value positive">{{ getPositiveVarianceCount() }}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Negative Variance</div>
          <div class="summary-value negative">{{ getNegativeVarianceCount() }}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Avg Efficiency</div>
          <div class="summary-value">{{ getAverageEfficiency() }}%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="content-grid" *ngIf="filteredRecords.length > 0">
    <div class="chart-card" @slideIn>
      <div class="section-header">
        <h2>Production Trends</h2>
        <div class="chart-legend">
          <div class="legend-item">
            <div class="legend-color expected"></div>
            <span>Expected</span>
          </div>
          <div class="legend-item">
            <div class="legend-color actual"></div>
            <span>Actual</span>
          </div>
        </div>
      </div>
      <div class="chart-placeholder">
        <div class="chart-icon">üìà</div>
        <p>Production trend chart would appear here</p>
        <small>Daily expected vs actual output comparison</small>
      </div>
    </div>

    <div class="metrics-card" @slideIn>
      <div class="section-header">
        <h2>Key Metrics</h2>
      </div>
      <div class="metrics-content">
        <div class="metric-item">
          <div class="metric-label">Best Performing Product</div>
          <div class="metric-value">{{ getBestProduct() }}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Highest Variance Day</div>
          <div class="metric-value">{{ getHighestVarianceDate() }}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Cost Efficiency</div>
          <div class="metric-value">{{ getCostEfficiency() }}%</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Recommendation</div>
          <div class="metric-recommendation">{{ getRecommendation() }}</div>
        </div>
      </div>
    </div>
  </div>
</div>